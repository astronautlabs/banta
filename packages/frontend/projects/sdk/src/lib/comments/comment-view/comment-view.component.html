<div class="message-container">
    <ng-content select="[data-before]"></ng-content>

    <a mat-button class="nav" [class.visible]="isViewingMore" href="javascript:;" (click)="showNew()">
        <mat-icon>file_upload</mat-icon>
        New
        <ng-container *ngIf="newMessages.length >= 1">
            ({{newMessages.length}})
        </ng-container>
    </a>

    <ng-container *ngIf="messages.length === 0">
        <div class="empty-state" *ngIf="showEmptyState">
            Be the first to comment!
        </div>
    </ng-container>
    <ng-container *ngFor="let message of messages; trackBy: messageIdentity">
        <banta-comment
            *ngIf="!message.hidden"
            class="abbreviated"
            [message]="message"
            [liking]="message['$liking']"
            [mine]="currentUser?.id === message.user?.id"
            [likeAllowed]="likeAllowed"
            [editAllowed]="editAllowed"
            (click)="isViewingMore = true"
            [showReplyAction]="allowReplies"
            [editing]="message.transientState.editing"
            (editStarted)="startEditing(message)"
            (editEnded)="message.transientState.editing = false"
            (edited)="saveEdit(message, $event)"
            (userSelected)="selectMessageUser(message)"
            (avatarSelected)="selectAvatar($event)"
            (usernameSelected)="selectUsername($event)"
            (liked)="likeMessage(message)"
            (unliked)="unlikeMessage(message)"
            (reported)="reportMessage(message)"
            (selected)="selectMessage(message)"
            (shared)="sharedMessage($event)"
            ></banta-comment>
    </ng-container>

    <a mat-button class="nav" [class.visible]="hasMore && !isLoadingMore" href="javascript:;" (click)="showMore()">Show more</a>

    <div class="loading-more" *ngIf="isLoadingMore">
        <mat-spinner></mat-spinner>
    </div>

    <!-- <div style="color: #666">
        n={{newMessages.length}}, m={{messages.length}}, o={{olderMessages.length}},
        v={{maxVisibleMessages}}, M={{maxMessages}}
    </div> -->

    <ng-content select=":not([data-before])"></ng-content>
</div>
