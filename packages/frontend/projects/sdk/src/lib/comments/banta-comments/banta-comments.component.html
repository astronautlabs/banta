
<div class="focused" *ngIf="selectedMessage">

    <div>
        <a mat-button href="javascript:;" (click)="unselectMessage()">
            <mat-icon>arrow_back</mat-icon>
            Latest Comments
        </a>
    </div>

    <banta-comment 
        [message]="selectedMessage"
        ></banta-comment>

    <div class="replies">
        Reply
        <form class="new-message" (submit)="sendReply()">
            <div class="text-container">
                <textarea 
                    name="message" 
                    (keydown)="onReplyKeyDown($event)"
                    [(ngModel)]="replyMessage"></textarea>
                <emoji-selector-button 
                    class="top-right"
                    (selected)="insertReplyEmoji($event)"
                    ></emoji-selector-button>
            </div>
            <button [disabled]="!replyMessage" 
                mat-raised-button color="primary">Send</button>
        </form>
        <banta-comment-view 
            [source]="selectedMessageThread"
            [allowReplies]="false"
            [fixedHeight]="false"
            [showEmptyState]="false"
            ></banta-comment-view>
    </div>
</div>

<form class="new-message" (submit)="sendMessage()" *ngIf="!selectedMessage">
    <div class="text-container">
        <textarea 
            name="message" 
            placeholder="Type your comment"
            (keydown)="onKeyDown($event)"
            [(ngModel)]="newMessageText"></textarea>
        <emoji-selector-button 
            class="top-right"
            (selected)="insertEmoji($event)"
            ></emoji-selector-button>
    </div>
    <div class="actions">
        <ng-container *ngIf="!user">
            <button 
                mat-raised-button 
                color="primary"
                type="button"
                (click)="showSignIn()"
                >{{signInLabel}}</button>
        </ng-container>
        <ng-container *ngIf="user">
            <button 
                *ngIf="canComment"
                mat-raised-button 
                color="primary"
                [disabled]="!newMessageText" 
                >{{sendLabel}}</button>
            <button 
                *ngIf="!canComment"
                type="button"
                (click)="showPermissionDenied()"
                mat-raised-button 
                color="primary"
                >{{permissionDeniedLabel}}</button>
        </ng-container>
    </div>
</form>

<banta-comment-view 
    [class.faded]="selectedMessage"
    [source]="source"
    [fixedHeight]="fixedHeight"
    [maxMessages]="maxMessages"
    [maxVisibleMessages]="maxVisibleMessages"
    [genericAvatarUrl]="genericAvatarUrl"
    (userSelected)="selectMessageUser($event)"
    (selected)="selectMessage($event)"
    (upvoted)="upvoteMessage($event)"
    (reported)="reportMessage($event)"
    ></banta-comment-view>